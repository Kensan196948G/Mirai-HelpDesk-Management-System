# 承認フローガイド

## 目次
- [承認フローとは](#承認フローとは)
- [承認依頼方法](#承認依頼方法)
- [承認/却下の判断基準](#承認却下の判断基準)
- [承認者の責任](#承認者の責任)
- [SOD（職務分離）の遵守](#sod職務分離の遵守)

---

## 承認フローとは

### 目的
特権的な操作やコストが発生する作業について、適切な権限を持つ担当者の承認を得るプロセスです。

### 承認が必要な操作

| 操作種別 | 理由 | 承認者レベル |
|---------|------|------------|
| **ライセンス追加/変更** | コスト発生 | Manager/Approver |
| **特権的な権限付与** | セキュリティリスク | Manager |
| **データ削除/復元** | データ保護 | Manager/Approver |
| **全社設定変更** | 全社影響 | Manager/Approver |
| **高額ハードウェア** | 高コスト | IT部門長 |
| **グローバル管理者権限** | 最高権限 | IT部門長 |

---

## 承認依頼方法

### Agent側の手順

1. **チケット作成または受付**
2. **トリアージで承認が必要と判断**
3. **承認依頼作成**

```
チケット詳細画面 → 「承認依頼」ボタン → 承認依頼フォーム
```

4. **承認依頼内容を詳細に記載**

```markdown
【操作内容】
ユーザー「tanaka@company.com」にMicrosoft 365 E5ライセンスを付与

【理由】
営業部への異動に伴い、以下の機能が必要:
- Power BI Pro
- Advanced Threat Protection
- Microsoft Defender for Office 365

【影響】
- 月額コスト: +3,000円
- 年間コスト: +36,000円
- 既存ライセンス（E3）からのアップグレード

【代替案の検討】
- E3 + Power BI Pro個別: 月額+2,500円
→ Advanced Threat Protectionも必要なため、E5が適切

【実施予定日】
2025-01-21（承認後即座に実施可能）

【リスク】
- コスト増加
- ライセンス在庫: 現在3つ利用可能

【ロールバック手順】
E5ライセンスを削除し、E3に戻す（月額コスト減）
```

5. **承認者を選択**
   - システムが推奨承認者を表示
   - SODチェック: 自分自身は選択不可

6. **承認依頼送信**
   - ステータスが「Pending Approval」に変更
   - 承認者にメール通知送信

---

## 承認/却下の判断基準

### Approverの確認事項

承認依頼を受けたら、以下を確認します。

#### 1. 妥当性の確認

```
□ 依頼内容は業務上必要か
□ 依頼者の所属部署・役職は適切か
□ 理由は明確で納得できるか
□ 代替案は検討されているか
```

#### 2. リスク評価

```
□ セキュリティリスクは許容範囲か
□ コストは予算内か
□ 全社的な影響はないか
□ 規定・ポリシーに違反していないか
```

#### 3. 実施計画の確認

```
□ 実施予定日は適切か
□ ロールバック手順は明確か
□ 影響範囲は把握されているか
□ SODは遵守されているか（承認者≠実施者）
```

---

### 承認する場合

1. **承認コメント記載**

```markdown
【承認】

以下を確認の上、承認します。

✅ 業務上の必要性: 営業部の業務要件として妥当
✅ コスト: 予算内（月額+3,000円）
✅ セキュリティ: 問題なし
✅ ロールバック: 手順明確

【条件】
- 実施後、利用状況を1ヶ月後にレビュー
- 使用していない場合は E3 にダウングレード

【承認日時】: 2025-01-20 15:30
【承認者】: 鈴木太郎（IT Manager）
```

2. **「承認」ボタンをクリック**
3. **ステータスが「In Progress」に戻る**
4. **実施者（M365 Operator）に通知**

---

### 却下する場合

1. **却下理由を明確に記載**

```markdown
【却下】

以下の理由により、本依頼を却下します。

❌ コスト: 予算超過（月額許容額は+2,000円まで）
❌ 代替案: Power BI Pro個別購入で対応可能

【代替提案】
以下の構成を推奨します:
- 既存: Microsoft 365 E3（変更なし）
- 追加: Power BI Pro（月額+1,500円）
- Advanced Threat Protection: 部署全体で検討中のため保留

【再申請】
上記代替案で再申請してください。

【却下日時】: 2025-01-20 15:30
【却下者】: 鈴木太郎（IT Manager）
```

2. **「却下」ボタンをクリック**
3. **ステータスが「Rejected」に変更**
4. **依頼者とAgentに通知**

---

### 追加情報が必要な場合

```markdown
【追加情報依頼】

承認判断のため、以下の情報を追加してください。

1. 具体的な利用シーン:
   - Power BI Pro: どのようなダッシュボードを作成するか
   - Advanced Threat Protection: 過去の脅威検知実績

2. 利用期間:
   - 一時的（プロジェクト期間のみ）
   - 恒久的

3. 他の部署でも同様の要望があるか:
   - ある場合、まとめて検討すべきか

上記情報をコメントで追加してください。
```

---

## 承認者の責任

### 承認者に求められること

1. **迅速な判断**
   - 承認依頼後、4時間以内（営業時間内）に対応
   - SLA遵守のため、速やかな判断が必要

2. **適切なリスク評価**
   - セキュリティリスク
   - コストインパクト
   - 業務への影響

3. **説明責任**
   - 承認/却下の理由を明確に説明
   - 監査時に説明できる記録を残す

4. **SOD遵守**
   - 自分が実施する作業は承認しない
   - 承認と実施は必ず分離

---

## SOD（職務分離）の遵守

### SODとは

**Segregation of Duties（職務分離）** は、不正や誤操作を防ぐために、承認と実施を異なる人が担当する原則です。

### SODルール

```
✅ 承認者 ≠ 実施者（M365 Operator）
✅ 複数人による確認
✅ システムが自動的にチェック
```

### SOD違反の例

❌ **違反ケース1**:
```
承認者: 田中
実施者: 田中（同一人物）
→ システムが自動的にブロック
```

❌ **違反ケース2**:
```
チケット作成者: 山田
承認者: 山田（同一人物）
→ 警告表示、承認可能だが推奨されない
```

✅ **正しいケース**:
```
チケット作成者: 佐藤（Agent）
承認者: 鈴木（Manager）
実施者: 田中（M365 Operator）
→ 全員異なる、SOD遵守
```

---

## 承認フロー図

```
┌─────────────────┐
│ Agent           │
│ 承認依頼作成     │
└────────┬────────┘
         │
         ↓
┌─────────────────┐
│ Approver        │
│ 承認/却下判断    │
└────────┬────────┘
         │
    ┌────┴────┐
    │          │
   承認        却下
    │          │
    ↓          ↓
┌─────────┐  ┌─────────┐
│M365     │  │依頼者   │
│Operator │  │に通知   │
│実施     │  └─────────┘
└────┬────┘
     │
     ↓
┌─────────────┐
│実施ログ記録 │
└─────────────┘
```

---

## 緊急時の承認

### 緊急承認が必要な状況

- P1インシデント
- 業務停止
- セキュリティ緊急対応

### 緊急承認手順

1. **システム上で承認依頼作成**（記録のため必須）
2. **電話/Teamsで直接連絡**
3. **口頭承認を取得**
4. **システム上で正式承認を後から記録**

```
【緊急承認記録】

電話にて緊急承認を取得しました。

【承認日時】: 2025-01-20 10:15（電話）
【承認者】: 鈴木太郎（IT Manager）
【承認内容】: 全社メールサーバー復旧のための緊急設定変更
【理由】: P1インシデント、業務停止中

正式承認をシステム上で記録します。
```

---

## 承認依頼チェックリスト

### Agent向け（承認依頼作成時）

```
□ 操作内容は明確か
□ 理由は十分に説明されているか
□ コストインパクトは記載されているか
□ 代替案は検討したか
□ 実施予定日は記載されているか
□ ロールバック手順は明確か
□ エビデンスは添付されているか（必要な場合）
□ 適切な承認者を選択したか
□ SODは遵守されているか
```

### Approver向け（承認判断時）

```
□ 依頼内容を理解したか
□ 業務上の必要性は確認したか
□ コストは予算内か
□ セキュリティリスクは許容範囲か
□ ポリシーに違反していないか
□ ロールバック手順は明確か
□ SODは遵守されているか（承認者≠実施者）
□ 承認/却下理由を明確に記載したか
```

---

## 関連ドキュメント

- [M365操作マニュアル](./M365操作マニュアル.md)
- [トリアージガイド](./トリアージガイド.md)
- [監査レポート出力](./監査レポート出力.md)

---

**最終更新日**: 2025年1月20日
**バージョン**: 1.0
