# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¬ã‚¤ãƒ‰ - é–‹ç™ºè€…å‘ã‘

## ğŸ“‹ ç›®æ¬¡

1. [ãƒ†ã‚¹ãƒˆç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#ãƒ†ã‚¹ãƒˆç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
2. [ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ](#ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ)
3. [GitHub Actionsã¨ã®æ•´åˆæ€§](#github-actionsã¨ã®æ•´åˆæ€§)
4. [ãƒ†ã‚¹ãƒˆãƒ‡ãƒãƒƒã‚°æ–¹æ³•](#ãƒ†ã‚¹ãƒˆãƒ‡ãƒãƒƒã‚°æ–¹æ³•)
5. [æ–°ã—ã„ãƒ†ã‚¹ãƒˆã®è¿½åŠ ](#æ–°ã—ã„ãƒ†ã‚¹ãƒˆã®è¿½åŠ )

---

## ãƒ†ã‚¹ãƒˆç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶

- **Node.js**: 18.xä»¥ä¸Š
- **PostgreSQL**: 15ä»¥ä¸Šï¼ˆã¾ãŸã¯é–‹ç™ºç”¨SQLiteï¼‰
- **Redis**: æœ€æ–°ç‰ˆï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™ç”¨ï¼‰
- **OS**: Linux, macOS, Windows

### 2. åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³
git clone <repository-url>
cd Mirai-HelpDesk-Management-System

# 2. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm ci                    # ãƒ«ãƒ¼ãƒˆï¼ˆPlaywrightç”¨ï¼‰
cd backend && npm ci      # ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
cd ../frontend && npm ci  # ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

# 3. Playwrightãƒ–ãƒ©ã‚¦ã‚¶ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npx playwright install chromium --with-deps

# 4. ç’°å¢ƒå¤‰æ•°è¨­å®š
cp backend/.env.example backend/.env
cp frontend/.env.development.example frontend/.env.development  # å¿…è¦ã«å¿œã˜ã¦

# 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–
cd backend
npm run migrate  # ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
npm run seed     # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŠ•å…¥
```

### 3. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆã§
./start-dev.sh
```

**èµ·å‹•ç¢ºèª**:
```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:3000/health

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹
curl -I http://localhost:3001

# ãƒ—ãƒ­ã‚­ã‚·å‹•ä½œç¢ºèªï¼ˆé‡è¦ï¼ï¼‰
curl http://localhost:3001/api/health
```

**æœŸå¾…ã•ã‚Œã‚‹å¿œç­”**:
```json
{"status":"OK","timestamp":"2026-02-04T...","uptime":...}
```

---

## ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆæ¨å¥¨: workers=2ï¼‰
npx playwright test --workers=2

# çµæœè¡¨ç¤º
npx playwright show-report
```

### ã‚«ãƒ†ã‚´ãƒªåˆ¥å®Ÿè¡Œ

```bash
# èªè¨¼ãƒ†ã‚¹ãƒˆã®ã¿
npx playwright test tests/e2e/auth-updated.spec.js

# AIæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã®ã¿
npx playwright test tests/e2e/ai-features.spec.js \
  tests/e2e/ai-authenticated.spec.js

# æ–°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã®ã¿
npx playwright test tests/e2e/m365-tasks.spec.js \
  tests/e2e/approval-workflow.spec.js

# APIçµ±åˆãƒ†ã‚¹ãƒˆã®ã¿
npx playwright test tests/e2e/api-integration.spec.js
```

### ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰

```bash
# UIãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚¹ãƒ†ãƒƒãƒ—ãƒã‚¤ã‚¹ãƒ†ãƒƒãƒ—å®Ÿè¡Œï¼‰
npx playwright test --ui

# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ï¼ˆPlaywrightã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ãƒ¼ï¼‰
npx playwright test tests/e2e/auth-updated.spec.js --debug

# ãƒ˜ãƒƒãƒ‰ãƒ¬ã‚¹ãƒ¢ãƒ¼ãƒ‰ç„¡åŠ¹ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã‚’è¡¨ç¤ºï¼‰
npx playwright test --headed

# ã‚¹ãƒ­ãƒ¼ãƒ¢ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
npx playwright test --headed --slow-mo=1000
```

### ãƒ¬ãƒãƒ¼ãƒˆã¨ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆ

```bash
# HTMLãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
npx playwright test --reporter=html

# ãƒ¬ãƒãƒ¼ãƒˆã‚’é–‹ã
npx playwright show-report

# ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆç¢ºèª
ls -la test-results/

# ãƒ“ãƒ‡ã‚ªç¢ºèªï¼ˆå¤±æ•—æ™‚ã®ã¿è¨˜éŒ²ï¼‰
ls -la test-results/**/*.webm
```

---

## GitHub Actionsã¨ã®æ•´åˆæ€§

### ãƒ­ãƒ¼ã‚«ãƒ«ã§CIç’°å¢ƒã‚’å†ç¾

```bash
# CIç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
export CI=true
export API_BASE_URL=http://127.0.0.1:3000
export FRONTEND_URL=http://127.0.0.1:3001

# CIã¨åŒã˜ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œ
npx playwright test --project=chromium

# ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ï¼ˆCIã¨åŒã˜ï¼‰
cd backend
npm run lint
npm run build
npm test || true

cd ../frontend
npm run lint
npm run build
npm test || true
```

### GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨ã®å¯¾å¿œ

| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | ãƒ­ãƒ¼ã‚«ãƒ«ã‚³ãƒãƒ³ãƒ‰ | èª¬æ˜ |
|---|---|---|
| **e2e.yml** | `npx playwright test` | E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |
| **code-quality.yml** | `npm run lint && npm run build` | Lint + ãƒ“ãƒ«ãƒ‰ |
| **auto-error-detection.yml** | `npm run lint:fix && npm run format` | è‡ªå‹•ä¿®å¾© |

### GitHub Actionsã§å¤±æ•—ã—ãŸå ´åˆ

1. **ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰**
   - GitHub Actions ã® Run ãƒšãƒ¼ã‚¸ã‹ã‚‰ `playwright-report-chromium` ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

2. **ãƒ­ãƒ¼ã‚«ãƒ«ã§å†ç¾**
   ```bash
   # åŒã˜ç’°å¢ƒå¤‰æ•°ã§å®Ÿè¡Œ
   CI=true npx playwright test
   ```

3. **ãƒ­ã‚°ã‚’ç¢ºèª**
   - `test-results/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒ»ãƒ“ãƒ‡ã‚ªã‚’ç¢ºèª

---

## ãƒ†ã‚¹ãƒˆãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### 1. ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒ»ãƒ“ãƒ‡ã‚ªã®æ´»ç”¨

ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã€è‡ªå‹•çš„ã«ä»¥ä¸‹ãŒè¨˜éŒ²ã•ã‚Œã¾ã™ï¼š

```bash
# ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ
test-results/comprehensive-test-suite-...-chromium/test-failed-1.png

# ãƒ“ãƒ‡ã‚ª
test-results/comprehensive-test-suite-...-chromium/video.webm

# ã‚¨ãƒ©ãƒ¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
test-results/comprehensive-test-suite-...-chromium/error-context.md
```

### 2. Playwrightã‚¤ãƒ³ã‚¹ãƒšã‚¯ã‚¿ãƒ¼ã®ä½¿ç”¨

```bash
# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã‚’ãƒ‡ãƒãƒƒã‚°
npx playwright test tests/e2e/auth-updated.spec.js --debug

# ãƒ–ãƒ¬ãƒ¼ã‚¯ãƒã‚¤ãƒ³ãƒˆã‚’è¨­å®šï¼ˆãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰å†…ï¼‰
await page.pause();  // ã“ã®è¡Œã§ä¸€æ™‚åœæ­¢
```

### 3. ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ­ã‚°ã®ç¢ºèª

ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰å†…ã§ console.log ã‚’è¿½åŠ ï¼š

```javascript
test('ãƒ‡ãƒãƒƒã‚°ä¾‹', async ({ page }) => {
  console.log('ç¾åœ¨ã®URL:', page.url());

  const elements = page.locator('input');
  const count = await elements.count();
  console.log('inputè¦ç´ æ•°:', count);

  const html = await page.content();
  console.log('HTMLï¼ˆæŠœç²‹ï¼‰:', html.substring(0, 500));
});
```

### 4. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ç›£è¦–

```javascript
test('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç›£è¦–ä¾‹', async ({ page }) => {
  page.on('request', request => {
    console.log('ãƒªã‚¯ã‚¨ã‚¹ãƒˆ:', request.method(), request.url());
  });

  page.on('response', response => {
    console.log('ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', response.status(), response.url());
  });

  await page.goto('/tickets');
});
```

---

## æ–°ã—ã„ãƒ†ã‚¹ãƒˆã®è¿½åŠ 

### 1. ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

```bash
# tests/e2e/ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ä½œæˆ
touch tests/e2e/new-feature.spec.js
```

### 2. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

```javascript
/**
 * æ–°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
 */
import { test, expect } from '@playwright/test';
import { login, API_BASE_URL, TEST_CONFIG } from './helpers.js';

test.describe('æ–°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ', () => {
  // èªè¨¼ãŒå¿…è¦ãªå ´åˆ
  test.beforeEach(async ({ page }) => {
    const { email, password } = TEST_CONFIG.TEST_ACCOUNTS.admin;
    await login(page, email, password);
  });

  test('æ©Ÿèƒ½AãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹', async ({ page }) => {
    await page.goto('/new-feature');
    await page.waitForLoadState('networkidle');

    // ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
    const element = page.locator('[data-testid="feature-a"]');
    await expect(element).toBeVisible();

    console.log('âœ… æ©Ÿèƒ½AãŒæ­£å¸¸ã«å‹•ä½œã—ã¾ã—ãŸ');
  });

  test('APIçµŒç”±ã§æ©Ÿèƒ½Aã‚’å®Ÿè¡Œ', async ({ request }) => {
    const response = await request.post(`${API_BASE_URL}/api/new-feature`, {
      headers: {
        'Authorization': `Bearer ${authToken}`,
        'Content-Type': 'application/json'
      },
      data: {
        // ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
      }
    });

    expect(response.ok()).toBeTruthy();
    const body = await response.json();
    console.log('API ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', body);
  });
});
```

### 3. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç¢ºèª

```bash
# æ–°ã—ã„ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
npx playwright test tests/e2e/new-feature.spec.js

# ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
npx playwright test tests/e2e/new-feature.spec.js --debug
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã®æœ€é©åŒ–

```bash
# ä¸¦åˆ—åº¦ã‚’ä¸Šã’ã‚‹ï¼ˆCPUæ•°ã«å¿œã˜ã¦ï¼‰
npx playwright test --workers=4

# ç‰¹å®šã®ãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿
npx playwright test --project=chromium

# å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®ã¿å†å®Ÿè¡Œ
npx playwright test --last-failed
```

### CIç’°å¢ƒã§ã®æœ€é©åŒ–

```yaml
# .github/workflows/e2e.yml
strategy:
  fail-fast: false  # ä»–ã®ãƒ†ã‚¹ãƒˆã‚’ç¶™ç¶š
  matrix:
    browser: [chromium]  # å¿…è¦ãªãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿
```

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿

- âœ… ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯é–‹ç™ºç’°å¢ƒå°‚ç”¨
- âœ… ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼ˆæœ¬ç•ªã§ã¯ï¼‰
- âœ… æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ã—ãªã„

### èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³

- âœ… ãƒ†ã‚¹ãƒˆå¾Œã«LocalStorageã‚’ã‚¯ãƒªã‚¢
- âœ… ãƒˆãƒ¼ã‚¯ãƒ³ã¯ãƒ†ã‚¹ãƒˆå®Œäº†å¾Œã«ç„¡åŠ¹åŒ–
- âœ… ãƒ†ã‚¹ãƒˆã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å«ã‚ãªã„

---

## ä»˜éŒ²: helpers.js ä¸»è¦é–¢æ•°

### login()

```javascript
/**
 * ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ï¼ˆUIçµŒç”±ï¼‰- ãƒªãƒˆãƒ©ã‚¤æ©Ÿèƒ½ä»˜ã
 * @param {Page} page - Playwrightãƒšãƒ¼ã‚¸ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
 * @param {string} email - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
 * @param {string} password - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
 * @returns {Promise<string>} - JWTãƒˆãƒ¼ã‚¯ãƒ³
 */
export async function login(page, email, password)
```

**ç‰¹å¾´**:
- zustand persist (`auth-storage`) ã‹ã‚‰ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
- æœ€å¤§10å›ï¼ˆ5ç§’é–“ï¼‰ãƒªãƒˆãƒ©ã‚¤
- è¤‡æ•°ã‚»ãƒ¬ã‚¯ã‚¿å¯¾å¿œï¼ˆplaceholder, type, autocompleteï¼‰

### loginViaAPI()

```javascript
/**
 * ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ï¼ˆAPIçµŒç”±ã€é«˜é€Ÿï¼‰
 * @param {APIRequestContext} request - API requestã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
 * @param {string} email - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
 * @param {string} password - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
 * @returns {Promise<string>} - JWTãƒˆãƒ¼ã‚¯ãƒ³
 */
export async function loginViaAPI(request, email, password)
```

**ç”¨é€”**: APIçµ±åˆãƒ†ã‚¹ãƒˆã§é«˜é€Ÿãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ãªå ´åˆ

---

**æ›´æ–°æ—¥**: 2026-02-04
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
