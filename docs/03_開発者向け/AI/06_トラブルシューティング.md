# ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

AIæ©Ÿèƒ½ã«é–¢ã™ã‚‹ã‚ˆãã‚ã‚‹å•é¡Œã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€è§£æ±ºç­–ã€ãƒ‡ãƒãƒƒã‚°æ‰‹é †ã‚’è§£èª¬ã—ã¾ã™ã€‚

---

## ğŸ“‹ ç›®æ¬¡

1. [èªè¨¼ãƒ»APIæ¥ç¶šã®å•é¡Œ](#èªè¨¼apiæ¥ç¶šã®å•é¡Œ)
2. [ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å•é¡Œ](#ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å•é¡Œ)
3. [ç²¾åº¦ãƒ»å“è³ªã®å•é¡Œ](#ç²¾åº¦å“è³ªã®å•é¡Œ)
4. [ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œ](#ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œ)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å•é¡Œ](#ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å•é¡Œ)
6. [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å•é¡Œ](#ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å•é¡Œ)
7. [ãƒ‡ãƒãƒƒã‚°æ‰‹é †](#ãƒ‡ãƒãƒƒã‚°æ‰‹é †)

---

## èªè¨¼ãƒ»APIæ¥ç¶šã®å•é¡Œ

### å•é¡Œ 1: Claude API èªè¨¼ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
Claude API èªè¨¼ã‚¨ãƒ©ãƒ¼: APIã‚­ãƒ¼ãŒç„¡åŠ¹ã§ã™ã€‚ç’°å¢ƒå¤‰æ•° CLAUDE_API_KEY ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
```

**åŸå› **:
- `CLAUDE_API_KEY` ãŒæœªè¨­å®šã¾ãŸã¯ç„¡åŠ¹
- APIã‚­ãƒ¼ã®æœŸé™åˆ‡ã‚Œ
- APIã‚­ãƒ¼ã®æ¨©é™ä¸è¶³

**è§£æ±ºç­–:**

**ã‚¹ãƒ†ãƒƒãƒ—1: ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèª**
```bash
cd backend

# .env ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
ls -la .env

# CLAUDE_API_KEY ã®ç¢ºèª
grep CLAUDE_API_KEY .env

# æœŸå¾…ã•ã‚Œã‚‹å½¢å¼: sk-ant-api03-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

**ã‚¹ãƒ†ãƒƒãƒ—2: APIã‚­ãƒ¼ã®æœ‰åŠ¹æ€§ã‚’ç¢ºèª**
```bash
# ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ç¢ºèª
node test-claude-api.js

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
# âœ… Claude API æ¥ç¶šæˆåŠŸ
# âœ… ãƒ¢ãƒ‡ãƒ«: claude-sonnet-4-5-20250929
```

**ã‚¹ãƒ†ãƒƒãƒ—3: Anthropic Console ã§ç¢ºèª**
1. https://console.anthropic.com/ ã«ãƒ­ã‚°ã‚¤ãƒ³
2. API Keys ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã‚­ãƒ¼ã®æœ‰åŠ¹æ€§ã‚’ç¢ºèª
3. ç„¡åŠ¹ãªå ´åˆã¯æ–°ã—ã„ã‚­ãƒ¼ã‚’ç”Ÿæˆ
4. `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°
5. ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•

---

### å•é¡Œ 2: ãƒ¢ãƒ‡ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
model_not_found: The model 'claude-sonnet-4-5-20250929' does not exist
```

**åŸå› **:
- ãƒ¢ãƒ‡ãƒ«IDã®ã‚¹ãƒšãƒ«ãƒŸã‚¹
- ãƒ¢ãƒ‡ãƒ«ã®å»ƒæ­¢ï¼ˆå¤ã„ãƒ¢ãƒ‡ãƒ«IDï¼‰
- Anthropic API ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆé…å»¶

**è§£æ±ºç­–:**

**ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ¢ãƒ‡ãƒ«IDã®ç¢ºèª**
```bash
# .env ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ¢ãƒ‡ãƒ«è¨­å®šã‚’ç¢ºèª
grep CLAUDE_MODEL backend/.env

# æ­£ã—ã„å½¢å¼:
# CLAUDE_MODEL=claude-sonnet-4-5-20250929
```

**ã‚¹ãƒ†ãƒƒãƒ—2: åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ã‚’ç¢ºèª**
```typescript
// test-available-models.ts
import Anthropic from '@anthropic-ai/sdk';

const client = new Anthropic({ apiKey: process.env.CLAUDE_API_KEY });

// åˆ©ç”¨å¯èƒ½ãªãƒ¢ãƒ‡ãƒ«ã‚’ç¢ºèªï¼ˆAnthropic Console ã§ç¢ºèªï¼‰
// - claude-sonnet-4-5-20250929
// - claude-3-5-sonnet-20240620
// - claude-3-haiku-20240307
```

**ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­å®š**
```typescript
// backend/src/config/claude.config.ts ã«è¿½åŠ 
const fallbackModels = [
  'claude-sonnet-4-5-20250929',
  'claude-3-5-sonnet-20240620',  // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
];

export const claudeConfig: ClaudeConfig = {
  model: process.env.CLAUDE_MODEL || fallbackModels[0],
  // ...
};
```

---

## ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å•é¡Œ

### å•é¡Œ 3: AIãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™è¶…é

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
AIæ©Ÿèƒ½ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆåˆ¶é™ï¼ˆ10å›/åˆ†ï¼‰ã‚’è¶…ãˆã¾ã—ãŸã€‚ã‚ã¨ 45ç§’å¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚
```

**åŸå› **:
- çŸ­æ™‚é–“ã«å¤§é‡ã®AIåˆ†é¡ã‚’å®Ÿè¡Œ
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®é€£æ‰“ï¼ˆãƒœã‚¿ãƒ³äºŒé‡ã‚¯ãƒªãƒƒã‚¯ï¼‰
- ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¸ãƒ§ãƒ–ã®åŒæ™‚å®Ÿè¡Œ

**è§£æ±ºç­–:**

**ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®ç¢ºèª**
```bash
# Redis ã§ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’ç¢ºèª
redis-cli

> KEYS ai-rate-limit:*
> GET ai-rate-limit:user-uuid
> TTL ai-rate-limit:user-uuid
```

**ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’ç·©å’Œï¼ˆä¸€æ™‚çš„ï¼‰**
```bash
# backend/.env
AI_RATE_LIMIT_PER_USER=20  # 10 â†’ 20 ã«å¢—åŠ 
```

**ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã®å¯¾ç­–**
```typescript
// AIClassificationWidget.tsx

// ãƒœã‚¿ãƒ³ã®äºŒé‡ã‚¯ãƒªãƒƒã‚¯é˜²æ­¢
const [loading, setLoading] = useState(false);

const handleClassify = async () => {
  if (loading) return;  // æ—¢ã«å®Ÿè¡Œä¸­ãªã‚‰ç„¡è¦–

  setLoading(true);
  try {
    const result = await aiService.classifyTicket({ ... });
    setResult(result);
  } finally {
    setLoading(false);
  }
};
```

---

### å•é¡Œ 4: Claude API ãƒ¬ãƒ¼ãƒˆåˆ¶é™è¶…é

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
Claude API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼: Rate limit exceeded. ã—ã°ã‚‰ãå¾…ã£ã¦ã‹ã‚‰å†è©¦è¡Œã—ã¦ãã ã•ã„ã€‚
```

**åŸå› **:
- Anthropic API ã®ä½¿ç”¨é‡åˆ¶é™ã‚’è¶…é
- ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ—ãƒ©ãƒ³ã§ãªã„å ´åˆã®åˆ¶é™

**è§£æ±ºç­–:**

**ã‚¹ãƒ†ãƒƒãƒ—1: Anthropic Console ã§ä½¿ç”¨é‡ã‚’ç¢ºèª**
1. https://console.anthropic.com/ â†’ Usage
2. æ—¥æ¬¡/æœˆæ¬¡ã®ä½¿ç”¨é‡ã‚’ç¢ºèª
3. åˆ¶é™ã«é”ã—ã¦ã„ã‚‹å ´åˆã¯ã€ãƒ—ãƒ©ãƒ³å¤‰æ›´ã‚’æ¤œè¨

**ã‚¹ãƒ†ãƒƒãƒ—2: ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æ´»ç”¨**
```typescript
// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡ã‚’ç¢ºèª
const cacheStats = await redis.info('stats');
console.log('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆç‡:', cacheStats.keyspace_hits / (cacheStats.keyspace_hits + cacheStats.keyspace_misses));

// æœŸå¾…å€¤: 30% ä»¥ä¸Š
```

**ã‚¹ãƒ†ãƒƒãƒ—3: ãƒãƒƒãƒå‡¦ç†ã®èª¿æ•´**
```typescript
// åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ç”Ÿæˆã‚’å¤œé–“ãƒãƒƒãƒã«ç§»è¡Œ
// cron: 0 2 * * * ï¼ˆæ¯æ—¥ åˆå‰2æ™‚ï¼‰

// åŒæ™‚å®Ÿè¡Œæ•°ã‚’åˆ¶é™
const concurrency = 5;  // 5ä»¶ãšã¤å‡¦ç†
for (let i = 0; i < tickets.length; i += concurrency) {
  const batch = tickets.slice(i, i + concurrency);
  await Promise.all(batch.map(ticket => generateEmbedding(ticket)));
  await sleep(1000);  // 1ç§’å¾…æ©Ÿ
}
```

---

## ç²¾åº¦ãƒ»å“è³ªã®å•é¡Œ

### å•é¡Œ 5: ç‰¹å®šã®ã‚«ãƒ†ã‚´ãƒªã§ç²¾åº¦ãŒä½ã„

**ç—‡çŠ¶**: ã€ŒPCãƒ»ç«¯æœ« > ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢éšœå®³ã€ã®ç²¾åº¦ãŒ 60%ç¨‹åº¦

**è¨ºæ–­**:
```sql
-- ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®ç²¾åº¦ã‚’åˆ†æ
SELECT
  c.name,
  COUNT(*) as total,
  ROUND(AVG(CASE WHEN p.was_accepted = true THEN 100 ELSE 0 END), 2) as accuracy
FROM ai_predictions p
JOIN categories c ON p.predicted_value::UUID = c.category_id
WHERE p.prediction_type = 'category'
  AND p.created_at >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY c.name
ORDER BY accuracy ASC;
```

**è§£æ±ºç­–:**

**ã‚¹ãƒ†ãƒƒãƒ—1: Few-shot Examples ã‚’è¿½åŠ **
```typescript
// ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã€ŒPCãƒ»ç«¯æœ«ã€ã®æˆåŠŸä¾‹ã‚’è¿½åŠ 
const fewShotExamples = `
# ä¾‹: PCãƒ»ç«¯æœ« > ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢éšœå®³
å…¥åŠ›:
  ä»¶å: "PCã®é›»æºãŒå…¥ã‚‰ãªã„"
  è©³ç´°: "é›»æºãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚‚åå¿œãŒã‚ã‚Šã¾ã›ã‚“ã€‚å……é›»ãƒ©ãƒ³ãƒ—ã‚‚ç‚¹ç¯ã—ã¾ã›ã‚“ã€‚"

å‡ºåŠ›:
\`\`\`json
{
  "category": {
    "value": "pc-hardware-uuid",
    "confidence": 0.93,
    "reasoning": "é›»æºãŒå…¥ã‚‰ãªã„ã€å……é›»ãƒ©ãƒ³ãƒ—ç‚¹ç¯ãªã— ã‹ã‚‰ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢éšœå®³ã¨åˆ¤æ–­ã—ã¾ã—ãŸã€‚"
  }
}
\`\`\`
`;
```

**ã‚¹ãƒ†ãƒƒãƒ—2: ã‚«ãƒ†ã‚´ãƒªèª¬æ˜ã‚’å……å®Ÿ**
```sql
UPDATE categories
SET description = 'PCæœ¬ä½“ã€ãƒ¢ãƒ‹ã‚¿ãƒ¼ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã€ãƒã‚¦ã‚¹ç­‰ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢éšœå®³ã€‚é›»æºãŒå…¥ã‚‰ãªã„ã€ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œãªã„ã€ç•°éŸ³ãŒã™ã‚‹ç­‰ã®ç—‡çŠ¶ãŒè©²å½“ã€‚',
    keywords = ARRAY['PC', 'ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢', 'é›»æº', 'ãƒ¢ãƒ‹ã‚¿ãƒ¼', 'ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰', 'ãƒã‚¦ã‚¹', 'æ•…éšœ', 'ç•°éŸ³']
WHERE path = 'PCãƒ»ç«¯æœ« > ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢éšœå®³';
```

---

### å•é¡Œ 6: JSON ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
AIåˆ†é¡çµæœã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒä¸æ­£ã§ã™ã€‚
```

**åŸå› **:
- Claude ãŒ JSON ä»¥å¤–ã®èª¬æ˜æ–‡ã‚’å«ã‚ã¦å›ç­”
- JSON ã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ï¼ˆã‚«ãƒ³ãƒæŠœã‘ã€æ‹¬å¼§ã®ä¸ä¸€è‡´ï¼‰

**è¨ºæ–­**:
```typescript
// AIService.parseClassificationResponse() ã®ãƒ­ã‚°ã‚’ç¢ºèª
console.error('âŒ Claude APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‘ãƒ¼ã‚¹å¤±æ•—:', response);
```

**è§£æ±ºç­–:**

**ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å³æ ¼åŒ–**
```typescript
const prompt = `
...

# å‡ºåŠ›å½¢å¼ï¼ˆå¿…ãšã“ã®å½¢å¼ã§å›ç­”ã—ã¦ãã ã•ã„ï¼‰
\`\`\`json
{
  "category": { ... }
}
\`\`\`

**é‡è¦**:
- JSONä»¥å¤–ã®èª¬æ˜æ–‡ã¯ä¸è¦ã§ã™ã€‚
- å¿…ãš \`\`\`json ã§å›²ã‚“ã§ãã ã•ã„ã€‚
- ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆ//ï¼‰ã¯å«ã‚ãªã„ã§ãã ã•ã„ã€‚
- æœ«å°¾ã®ã‚«ãƒ³ãƒã¯å«ã‚ãªã„ã§ãã ã•ã„ã€‚
`;
```

**ã‚¹ãƒ†ãƒƒãƒ—2: ãƒ‘ãƒ¼ã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®æ”¹å–„**
```typescript
private static parseClassificationResponse(response: string): TicketClassificationResult['predictions'] {
  try {
    // JSONéƒ¨åˆ†ã‚’æŠ½å‡ºï¼ˆ```json ... ``` ã§å›²ã¾ã‚Œã¦ã„ã‚‹å ´åˆï¼‰
    let jsonText = response;

    // ãƒ‘ã‚¿ãƒ¼ãƒ³1: ```json ... ```
    const jsonMatch1 = response.match(/```json\s*([\s\S]*?)\s*```/);
    if (jsonMatch1) {
      jsonText = jsonMatch1[1];
    }

    // ãƒ‘ã‚¿ãƒ¼ãƒ³2: ``` ... ``` (json ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãªã—)
    const jsonMatch2 = response.match(/```\s*([\s\S]*?)\s*```/);
    if (!jsonMatch1 && jsonMatch2) {
      jsonText = jsonMatch2[1];
    }

    // JSONã‚’ãƒ‘ãƒ¼ã‚¹
    const parsed = JSON.parse(jsonText);

    return {
      category: parsed.category || undefined,
      priority: parsed.priority || undefined,
      impact: parsed.impact || undefined,
      urgency: parsed.urgency || undefined,
      assignee: parsed.assignee || undefined,
    };
  } catch (error) {
    console.error('âŒ Claude APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®ãƒ‘ãƒ¼ã‚¹å¤±æ•—:', response);

    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹å…¨ä½“ã‚’ãƒ­ã‚°ã«è¨˜éŒ²ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
    await logParseError(response, error);

    throw new Error('AIåˆ†é¡çµæœã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒä¸æ­£ã§ã™ã€‚');
  }
}
```

---

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å•é¡Œ

### å•é¡Œ 7: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ãŒé…ã„ï¼ˆ5ç§’ä»¥ä¸Šï¼‰

**è¨ºæ–­**:
```sql
-- å‡¦ç†æ™‚é–“ã®åˆ†å¸ƒã‚’ç¢ºèª
SELECT
  prediction_type,
  ROUND(AVG(processing_time_ms), 0) as avg_ms,
  ROUND(PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY processing_time_ms), 0) as p50_ms,
  ROUND(PERCENTILE_CONT(0.9) WITHIN GROUP (ORDER BY processing_time_ms), 0) as p90_ms,
  ROUND(PERCENTILE_CONT(0.99) WITHIN GROUP (ORDER BY processing_time_ms), 0) as p99_ms,
  MAX(processing_time_ms) as max_ms
FROM ai_predictions
WHERE created_at >= CURRENT_DATE - INTERVAL '7 days'
GROUP BY prediction_type;
```

**çµæœä¾‹**:
```
prediction_type | avg_ms | p50_ms | p90_ms | p99_ms | max_ms
----------------+--------+--------+--------+--------+-------
category        | 3250   | 2850   | 4500   | 6200   | 8500
```

**å•é¡Œ**: p90 ãŒ 4.5ç§’ï¼ˆç›®æ¨™: 3ç§’ä»¥å†…ï¼‰

**è§£æ±ºç­–:**

**ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®é•·ã•ã‚’å‰Šæ¸›**
```typescript
// Before: é¡ä¼¼ãƒã‚±ãƒƒãƒˆ 10ä»¶
const similarTicketsResult = await query(`... LIMIT 10`);

// After: é¡ä¼¼ãƒã‚±ãƒƒãƒˆ 5ä»¶
const similarTicketsResult = await query(`... LIMIT 5`);
```

**ã‚¹ãƒ†ãƒƒãƒ—2: maxTokens ã‚’å‰Šæ¸›**
```typescript
// Before
maxTokens: 4096

// Afterï¼ˆãƒã‚±ãƒƒãƒˆåˆ†é¡ã¯çŸ­ã„å‡ºåŠ›ã§ååˆ†ï¼‰
maxTokens: 2048
```

**ã‚¹ãƒ†ãƒƒãƒ—3: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨**
```typescript
// åŒä¸€ãƒã‚±ãƒƒãƒˆã®å†åˆ†é¡ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰å–å¾—
const cacheKey = input.ticket_id ? `ai-classify:${input.ticket_id}` : undefined;

const response = await claudeClient.sendPrompt(prompt, systemPrompt, {
  cacheKey,
  cacheTTL: 3600,  // 1æ™‚é–“
  userId: input.requester_id,
});
```

---

### å•é¡Œ 8: Redis æ¥ç¶šã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
âŒ Redis ã‚¨ãƒ©ãƒ¼: ECONNREFUSED
```

**åŸå› **:
- Redis ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ãªã„
- REDIS_URL ãŒé–“é•ã£ã¦ã„ã‚‹
- Redis ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã‚‹

**è§£æ±ºç­–:**

**ã‚¹ãƒ†ãƒƒãƒ—1: Redis ã®èµ·å‹•ç¢ºèª**
```bash
# Redis ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
redis-cli ping

# æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›: PONG
```

**ã‚¹ãƒ†ãƒƒãƒ—2: Redis ã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•**
```bash
# macOSï¼ˆHomebrewï¼‰
brew services start redis

# Ubuntu/Debian
sudo systemctl start redis-server
sudo systemctl enable redis-server

# Docker
docker start redis
# ã¾ãŸã¯
docker run -d -p 6379:6379 --name redis redis:7-alpine
```

**ã‚¹ãƒ†ãƒƒãƒ—3: æ¥ç¶šãƒ†ã‚¹ãƒˆ**
```bash
# Redis CLI ã§æ¥ç¶šãƒ†ã‚¹ãƒˆ
redis-cli -h localhost -p 6379

# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
redis-cli -h localhost -p 6379 -a your-password
```

---

## ç²¾åº¦ãƒ»å“è³ªã®å•é¡Œ

### å•é¡Œ 9: ç²¾åº¦ãŒç›®æ¨™æœªé”ï¼ˆ90%æœªæº€ï¼‰

**è¨ºæ–­**:
```sql
-- éå»30æ—¥ã®ç²¾åº¦ãƒˆãƒ¬ãƒ³ãƒ‰
SELECT
  DATE_TRUNC('day', created_at) as day,
  ROUND(
    SUM(CASE WHEN was_accepted = true THEN 1 ELSE 0 END)::numeric /
    NULLIF(SUM(CASE WHEN was_accepted IS NOT NULL THEN 1 ELSE 0 END), 0) * 100,
    2
  ) as accuracy
FROM ai_predictions
WHERE prediction_type = 'category'
  AND created_at >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY day
ORDER BY day DESC;
```

**è§£æ±ºç­–**: [05_ç²¾åº¦æ”¹å–„ã‚¬ã‚¤ãƒ‰.md](./05_ç²¾åº¦æ”¹å–„ã‚¬ã‚¤ãƒ‰.md) ã‚’å‚ç…§

---

### å•é¡Œ 10: PII ãƒã‚¹ã‚­ãƒ³ã‚°ãŒå‹•ä½œã—ãªã„

**ç—‡çŠ¶**: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒãã®ã¾ã¾ Claude API ã«é€ä¿¡ã•ã‚Œã¦ã„ã‚‹

**è¨ºæ–­**:
```typescript
// PIIMasking.maskForAI() ã®ãƒ†ã‚¹ãƒˆ
import { PIIMasking } from '../utils/pii-masking';

const testText = 'æ‹…å½“è€…: yamada@company.comã€é›»è©±: 03-1234-5678';
const result = PIIMasking.maskForAI(testText);

console.log('å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆ:', testText);
console.log('ãƒã‚¹ã‚¯å¾Œ:', result.masked);
console.log('PIIæ¤œå‡º:', result.hasPII);
console.log('ãƒã‚¹ã‚¯ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰:', result.maskedFields);

// æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:
// ãƒã‚¹ã‚¯å¾Œ: æ‹…å½“è€…: [EMAIL_MASKED]ã€é›»è©±: [PHONE_MASKED]
// PIIæ¤œå‡º: true
// ãƒã‚¹ã‚¯ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰: ['email', 'phone']
```

**è§£æ±ºç­–:**

**ã‚¹ãƒ†ãƒƒãƒ—1: ENABLE_PII_MASKING ã®ç¢ºèª**
```bash
grep ENABLE_PII_MASKING backend/.env

# æœŸå¾…: ENABLE_PII_MASKING=true
```

**ã‚¹ãƒ†ãƒƒãƒ—2: æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç¢ºèª**
```typescript
// backend/src/utils/pii-masking.ts

// æ—¥æœ¬èªã®é›»è©±ç•ªå·ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å¼·åŒ–
private static readonly PHONE_REGEX = /(\d{2,4}[-\s]?\d{2,4}[-\s]?\d{4}|\d{10,11}|0\d{1,4}-\d{1,4}-\d{4})/g;
```

---

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å•é¡Œ

### å•é¡Œ 11: pgvector æ‹¡å¼µãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:**
```
ERROR: type "vector" does not exist
```

**åŸå› **:
- pgvector æ‹¡å¼µãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„
- `CREATE EXTENSION vector;` ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–:**

**ã‚¹ãƒ†ãƒƒãƒ—1: pgvector ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ç¢ºèª**
```bash
# PostgreSQL ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
psql --version

# æœŸå¾…: PostgreSQL 11 ä»¥ä¸Š
```

**ã‚¹ãƒ†ãƒƒãƒ—2: pgvector ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«**
```bash
# Ubuntu/Debian
sudo apt install postgresql-15-pgvector

# macOSï¼ˆHomebrewï¼‰
brew install pgvector

# ã‚½ãƒ¼ã‚¹ã‹ã‚‰ãƒ“ãƒ«ãƒ‰
git clone https://github.com/pgvector/pgvector.git
cd pgvector
make
sudo make install
```

**ã‚¹ãƒ†ãƒƒãƒ—3: æ‹¡å¼µæ©Ÿèƒ½ã®æœ‰åŠ¹åŒ–**
```sql
-- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«æ¥ç¶š
psql -U postgres -d mirai_helpdesk

-- æ‹¡å¼µæ©Ÿèƒ½ã‚’æœ‰åŠ¹åŒ–
CREATE EXTENSION IF NOT EXISTS vector;

-- ç¢ºèª
SELECT * FROM pg_extension WHERE extname = 'vector';
-- æœŸå¾…: extname | vector
```

**ã‚¹ãƒ†ãƒƒãƒ—4: ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†å®Ÿè¡Œ**
```bash
cd backend
npm run migrate

# 013_add_vector_search.sql ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
```

---

### å•é¡Œ 12: ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢ãŒé…ã„ï¼ˆ5ç§’ä»¥ä¸Šï¼‰

**è¨ºæ–­**:
```sql
-- HNSW ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ç¢ºèª
SELECT
  indexname,
  indexdef
FROM pg_indexes
WHERE tablename = 'ticket_embeddings';

-- æœŸå¾…:
-- idx_ticket_embeddings_combined_hnsw | CREATE INDEX ... USING hnsw ...
```

**è§£æ±ºç­–:**

**ã‚¹ãƒ†ãƒƒãƒ—1: VACUUM ã®å®Ÿè¡Œ**
```sql
-- ãƒ†ãƒ¼ãƒ–ãƒ«ã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æœ€é©åŒ–
VACUUM ANALYZE ticket_embeddings;
```

**ã‚¹ãƒ†ãƒƒãƒ—2: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®èª¿æ•´**
```sql
-- HNSW ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å†ä½œæˆï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¿æ•´ï¼‰
DROP INDEX IF EXISTS idx_ticket_embeddings_combined_hnsw;

CREATE INDEX idx_ticket_embeddings_combined_hnsw
  ON ticket_embeddings
  USING hnsw (combined_vector vector_cosine_ops)
  WITH (m = 16, ef_construction = 64);
  -- m: æ¥ç¶šæ•°ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 16ã€ç²¾åº¦é‡è¦–ãªã‚‰ 32ï¼‰
  -- ef_construction: æ§‹ç¯‰æ™‚ã®æ¢ç´¢æ·±ã•ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 64ã€ç²¾åº¦é‡è¦–ãªã‚‰ 128ï¼‰
```

**ã‚¹ãƒ†ãƒƒãƒ—3: ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®èª¿æ•´**
```sql
-- æ¤œç´¢æ™‚ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
SET hnsw.ef_search = 100;  -- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 40ã€ç²¾åº¦é‡è¦–ãªã‚‰ 100-200

-- æ¤œç´¢å®Ÿè¡Œ
SELECT ... ORDER BY combined_vector <=> $1::vector LIMIT 5;
```

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å•é¡Œ

### å•é¡Œ 13: AIã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„

**ç—‡çŠ¶**: ãƒã‚±ãƒƒãƒˆä½œæˆç”»é¢ã§AIåˆ†é¡ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„

**è¨ºæ–­**:
```typescript
// ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèª
console.log('AI Enabled:', aiEnabled);  // false ã®å ´åˆã¯å•é¡Œ

// aiStore ã®çŠ¶æ…‹ã‚’ç¢ºèª
import { useAIStore } from '@store/aiStore';
const { aiEnabled } = useAIStore();
console.log('aiEnabled:', aiEnabled);
```

**è§£æ±ºç­–:**

**ã‚¹ãƒ†ãƒƒãƒ—1: ç’°å¢ƒå¤‰æ•°ã®ç¢ºèª**
```bash
# frontend/.env.development
VITE_AI_ENABLED=true
```

**ã‚¹ãƒ†ãƒƒãƒ—2: aiStore ã®åˆæœŸåŒ–ç¢ºèª**
```typescript
// frontend/src/store/aiStore.ts

interface AIState {
  aiEnabled: boolean;  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: true ã«å¤‰æ›´
  // ...
}

export const useAIStore = create<AIState>((set) => ({
  aiEnabled: true,  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ true ã«
  // ...
}));
```

**ã‚¹ãƒ†ãƒƒãƒ—3: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒã‚¦ãƒ³ãƒˆç¢ºèª**
```typescript
// frontend/src/pages/tickets/TicketCreate.tsx

// AIClassificationWidget ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
import { AIClassificationWidget } from '@components/ai/AIClassificationWidget';

// æ¡ä»¶ä»˜ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã®ãƒ­ã‚¸ãƒƒã‚¯ç¢ºèª
{showAIWidget && (
  <AIClassificationWidget
    subject={form.getFieldValue('subject')}
    description={form.getFieldValue('description')}
    requesterId={user.user_id}
    onAccept={handleAcceptAIPredictions}
    onReject={() => setShowAIWidget(false)}
  />
)}
```

---

### å•é¡Œ 14: AIåˆ†é¡ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚‚åå¿œã—ãªã„

**è¨ºæ–­**:
```typescript
// ãƒ–ãƒ©ã‚¦ã‚¶ã® Network ã‚¿ãƒ–ã‚’ç¢ºèª
// - POST /api/ai/classify-ticket ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€ä¿¡ã•ã‚Œã¦ã„ã‚‹ã‹
// - ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆ200, 400, 401, 429, 503ï¼‰
// - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
```

**è§£æ±ºç­–:**

**CORS ã‚¨ãƒ©ãƒ¼ã®å ´åˆ**:
```bash
# backend/.env
CORS_ORIGIN=http://localhost:3001

# è¤‡æ•°ã®ã‚ªãƒªã‚¸ãƒ³ã‚’è¨±å¯ã™ã‚‹å ´åˆ
CORS_ORIGIN=http://localhost:3001,http://localhost:8080
```

**èªè¨¼ã‚¨ãƒ©ãƒ¼ã®å ´åˆ**:
```typescript
// JWTãƒˆãƒ¼ã‚¯ãƒ³ãŒæ­£ã—ãé€ä¿¡ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
console.log('Authorization Header:', axios.defaults.headers.common['Authorization']);

// æœŸå¾…: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6...
```

---

## ãƒ‡ãƒãƒƒã‚°æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ­ã‚°ã®ç¢ºèª

**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ­ã‚°**:
```bash
# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
tail -f backend/logs/app.log

# ã¾ãŸã¯æ¨™æº–å‡ºåŠ›
npm run dev

# æœŸå¾…ã•ã‚Œã‚‹ãƒ­ã‚°:
# âœ… Claude API: 2450ms, ãƒˆãƒ¼ã‚¯ãƒ³: 1250å…¥åŠ› + 580å‡ºåŠ› = 1830åˆè¨ˆ
# ğŸ“¦ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ’ãƒƒãƒˆ: ai-classify:ticket-uuid
# ğŸ’¾ 5ä»¶ã®AIäºˆæ¸¬ã‚’ä¿å­˜ã—ã¾ã—ãŸ
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ­ã‚°**:
```typescript
// ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«
console.log('AIåˆ†é¡çµæœ:', result);
console.log('å‡¦ç†æ™‚é–“:', result.processing_time_ms, 'ms');
console.log('PIIæ¤œå‡º:', result.pii_masked);
```

---

### ã‚¹ãƒ†ãƒƒãƒ—2: æ‰‹å‹•ã§APIã‚’ãƒ†ã‚¹ãƒˆ

**cURL ã§ãƒ†ã‚¹ãƒˆ**:
```bash
# 1. ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦JWTãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
TOKEN=$(curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email": "agent@company.com", "password": "password"}' \
  | jq -r '.data.token')

# 2. AIåˆ†é¡APIã‚’å‘¼ã³å‡ºã—
curl -X POST http://localhost:3000/api/ai/classify-ticket \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "subject": "ãƒ†ã‚¹ãƒˆãƒã‚±ãƒƒãƒˆ",
    "description": "ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆç”¨ã®ãƒã‚±ãƒƒãƒˆã§ã™ã€‚Outlooké–¢é€£ã®å•é¡Œã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚",
    "requester_id": "user-uuid"
  }' | jq .

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèª
```

---

### ã‚¹ãƒ†ãƒƒãƒ—3: Claude API ã®ç›´æ¥ãƒ†ã‚¹ãƒˆ

**ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ**:
```typescript
// backend/test-claude-api-direct.ts

import Anthropic from '@anthropic-ai/sdk';

async function testClaudeAPI() {
  const client = new Anthropic({
    apiKey: process.env.CLAUDE_API_KEY,
  });

  try {
    const response = await client.messages.create({
      model: 'claude-sonnet-4-5-20250929',
      max_tokens: 1024,
      messages: [
        {
          role: 'user',
          content: 'ã“ã‚“ã«ã¡ã¯ã€‚ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ã€‚',
        },
      ],
    });

    console.log('âœ… Claude API æ¥ç¶šæˆåŠŸ');
    console.log('ãƒ¬ã‚¹ãƒãƒ³ã‚¹:', response.content[0].text);
    console.log('ä½¿ç”¨ãƒˆãƒ¼ã‚¯ãƒ³:', response.usage);
  } catch (error) {
    console.error('âŒ Claude API ã‚¨ãƒ©ãƒ¼:', error);
  }
}

testClaudeAPI();
```

**å®Ÿè¡Œ**:
```bash
cd backend
ts-node test-claude-api-direct.ts
```

---

### ã‚¹ãƒ†ãƒƒãƒ—4: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¯ã‚¨ãƒªã®ç¢ºèª

**ai_predictions ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¢ºèª**:
```sql
-- æœ€æ–°ã®äºˆæ¸¬ã‚’ç¢ºèª
SELECT
  prediction_id,
  ticket_id,
  prediction_type,
  predicted_value,
  confidence_score,
  was_accepted,
  created_at
FROM ai_predictions
ORDER BY created_at DESC
LIMIT 10;
```

**ticket_embeddings ãƒ†ãƒ¼ãƒ–ãƒ«ã®ç¢ºèª**:
```sql
-- åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
SELECT
  embedding_id,
  ticket_id,
  embedding_version,
  created_at
FROM ticket_embeddings
ORDER BY created_at DESC
LIMIT 10;

-- æœŸå¾…: embedding_version = 'claude-sonnet-4-5-20250929'
```

---

## ç·Šæ€¥å¯¾å¿œãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ AIæ©Ÿèƒ½ãŒå‹•ä½œã—ãªã„      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚ ã‚¨ãƒ©ãƒ¼ç¢ºèª   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
    â”œâ”€ èªè¨¼ã‚¨ãƒ©ãƒ¼ï¼ˆ401ï¼‰ â†’ APIã‚­ãƒ¼ç¢ºèª â†’ Anthropic Console
    â”œâ”€ ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆ429ï¼‰ â†’ ä½¿ç”¨é‡ç¢ºèª â†’ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨
    â”œâ”€ AIç„¡åŠ¹ï¼ˆ503ï¼‰ â†’ AI_ENABLED=true â†’ ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
    â”œâ”€ Redisæ¥ç¶šã‚¨ãƒ©ãƒ¼ â†’ Redisèµ·å‹•ç¢ºèª â†’ æ¥ç¶šãƒ†ã‚¹ãƒˆ
    â”œâ”€ pgvector ã‚¨ãƒ©ãƒ¼ â†’ æ‹¡å¼µã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« â†’ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†å®Ÿè¡Œ
    â””â”€ ãã®ä»– â†’ ãƒ­ã‚°ç¢ºèª â†’ ç›´æ¥ãƒ†ã‚¹ãƒˆ â†’ Issueå ±å‘Š
```

---

## ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰

### Q1: AIãŒé–“é•ã£ãŸåˆ†é¡ã‚’ã™ã‚‹å ´åˆã€ã©ã†ã™ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ

**A**: ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„ã€‚

1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã€Œæ‰‹å‹•ã§å…¥åŠ›ã€ã‚’é¸æŠ
2. æ­£ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãƒã‚±ãƒƒãƒˆã‚’ä½œæˆ
3. ã‚·ã‚¹ãƒ†ãƒ ãŒè‡ªå‹•ã§ `was_accepted = false` ã‚’è¨˜éŒ²
4. æœˆæ¬¡ã§ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’åˆ†æã—ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ”¹å–„

---

### Q2: AIæ©Ÿèƒ½ã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹ã«ã§ãã¾ã™ã‹ï¼Ÿ

**A**: ã¯ã„ã€ç’°å¢ƒå¤‰æ•°ã§åˆ¶å¾¡ã§ãã¾ã™ã€‚

```bash
# backend/.env
AI_ENABLED=false  # AIæ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ–

# ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
npm run dev
```

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®AIã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚‚è‡ªå‹•ã§éè¡¨ç¤ºã«ãªã‚Šã¾ã™ã€‚

---

### Q3: ç‰¹å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿AIæ©Ÿèƒ½ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã§ãã¾ã™ã‹ï¼Ÿ

**A**: ã¯ã„ã€RBAC ã§åˆ¶å¾¡ã§ãã¾ã™ã€‚

```typescript
// backend/src/middleware/ai-auth.middleware.ts

export const aiRBAC = {
  canClassify: (user: User) => {
    // å…¨ãƒ­ãƒ¼ãƒ«ãŒä½¿ç”¨å¯èƒ½
    return true;
  },

  canUseSuggestions: (user: User) => {
    // Agent ä»¥ä¸Šã®ã¿
    return [UserRole.AGENT, UserRole.M365_OPERATOR, UserRole.APPROVER, UserRole.MANAGER].includes(user.role);
  },

  // ã‚«ã‚¹ã‚¿ãƒ åˆ¶å¾¡ã‚’è¿½åŠ 
  canUseAdvancedFeatures: (user: User) => {
    // Manager ã®ã¿
    return user.role === UserRole.MANAGER;
  },
};
```

---

### Q4: Claude API ã®ã‚³ã‚¹ãƒˆãŒäºˆæƒ³ã‚ˆã‚Šé«˜ã„

**A**: ä»¥ä¸‹ã®æœ€é©åŒ–ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚

1. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ´»ç”¨**: `AI_CACHE_TTL=7200`ï¼ˆ2æ™‚é–“ï¼‰ã«å»¶é•·
2. **ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆçŸ­ç¸®**: ä¸è¦ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å‰Šæ¸›
3. **maxTokens å‰Šæ¸›**: `CLAUDE_MAX_TOKENS=2048`ï¼ˆãƒã‚±ãƒƒãƒˆåˆ†é¡ç”¨ï¼‰
4. **ãƒãƒƒãƒå‡¦ç†**: åŸ‹ã‚è¾¼ã¿ãƒ™ã‚¯ãƒˆãƒ«ç”Ÿæˆã¯å¤œé–“ã«å®Ÿè¡Œ

ã‚³ã‚¹ãƒˆåˆ†æ:
```sql
SELECT
  DATE_TRUNC('day', created_at) as day,
  COUNT(*) as api_calls,
  SUM(processing_time_ms) / 1000.0 as total_seconds
FROM ai_predictions
WHERE created_at >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY day
ORDER BY day DESC;
```

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

- [07_ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢å®Ÿè£…ã‚¬ã‚¤ãƒ‰.md](./07_ãƒ™ã‚¯ãƒˆãƒ«æ¤œç´¢å®Ÿè£…ã‚¬ã‚¤ãƒ‰.md) - pgvector ã®è©³ç´°å®Ÿè£…
- [08_ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°.md](./08_ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°.md) - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

---

**æœ€çµ‚æ›´æ–°:** 2026å¹´2æœˆ
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 1.0.0
