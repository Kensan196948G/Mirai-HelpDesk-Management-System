# テストガイド

## テスト戦略

### テストピラミッド

```
    /\
   /E2E\       10% - End-to-End Tests
  /______\
 /        \
/Integration\ 20% - Integration Tests
/__________\
/            \
/  Unit Tests  \ 70% - Unit Tests
/______________\
```

## ユニットテスト（Jest）

### 実行方法

```bash
cd backend
npm test

# 特定のファイルのみ
npm test -- tickets.test.js

# カバレッジレポート
npm test -- --coverage
```

### テスト例

```javascript
// backend/src/services/__tests__/ticketService.test.js
describe('Ticket Service', () => {
  test('should create a new ticket', async () => {
    const ticketData = {
      subject: 'Test ticket',
      description: 'Test description',
      type: 'incident',
      priority: 'P3'
    };

    const result = await ticketService.createTicket(ticketData);

    expect(result.success).toBe(true);
    expect(result.data.ticket_number).toMatch(/TK-\d{6}/);
  });
});
```

## E2Eテスト（Playwright）

### 実行方法

```bash
# インストール（初回のみ）
npm install
npx playwright install

# すべてのE2Eテスト実行
npm run test:e2e

# 特定のテストファイル
npx playwright test tests/e2e/tickets.spec.js

# UIモード（デバッグ用）
npx playwright test --ui

# レポート表示
npx playwright show-report
```

### テスト例

```javascript
// tests/e2e/tickets.spec.js
test('should create a new ticket', async ({ page }) => {
  await page.goto('http://localhost:5173');

  // ログイン
  await page.fill('input[name="email"]', 'agent@example.com');
  await page.fill('input[name="password"]', 'Admin123!');
  await page.click('button[type="submit"]');

  // チケット作成
  await page.click('text=新規チケット');
  await page.fill('input[name="subject"]', 'E2E Test Ticket');
  await page.selectOption('select[name="type"]', 'incident');
  await page.click('button:has-text("作成")');

  // 確認
  await expect(page.locator('text=チケットが作成されました')).toBeVisible();
});
```

## カバレッジ目標

- ユニットテスト: 80%以上
- E2Eテスト: 主要フロー100%

## CI/CD統合

GitHub Actionsで自動テスト実行:

```yaml
# .github/workflows/test.yml
name: Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm install
      - run: npm test
      - run: npm run test:e2e
```

詳細は `/docs/E2E_TEST_IMPLEMENTATION.md` を参照してください。
