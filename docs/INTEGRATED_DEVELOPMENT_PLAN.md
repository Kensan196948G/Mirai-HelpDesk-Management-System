# Mirai HelpDesk Management System - 統合開発計画

**策定日**: 2026-01-20
**バージョン**: 2.0
**統合元プロジェクト**: Enterprise-IT-Helpdesk-AI, MicrosoftProductManagementSystem

---

## 1. 統合概要

### 統合の目的
2つの実績あるプロジェクトのベストプラクティスを統合し、エンタープライズグレードのヘルプデスク管理システムを構築する。

### 統合元プロジェクト分析

#### Enterprise-IT-Helpdesk-AI（採用要素）
- ✅ **監査ログ設計**: JSON Lines形式、追記専用
- ✅ **PIIマスキング**: 正規表現ベースの機密情報マスキング
- ✅ **セキュリティレビュープロセス**: CORS、エラーメッセージ、入力検証
- ✅ **運用Runbook**: トラブルシューティング手順書
- ✅ **ログローテーション**: Linux logrotate + Windows PowerShell
- ✅ **アクセシビリティ対応**: ARIA属性、セマンティックHTML

#### MicrosoftProductManagementSystem（採用要素）
- ✅ **M365統合パターン**: Microsoft Graph Client実装
- ✅ **認証設計**: 証明書ベース認証、トークンキャッシュ
- ✅ **Fluent Design UI**: Microsoft公式デザインシステム
- ✅ **包括的ドキュメント構造**: 6カテゴリ182+ファイル
- ✅ **FastAPI アーキテクチャ**: 26機能対応REST API
- ✅ **テスト戦略**: Pytest + Cypress + Playwright

---

## 2. 現在の開発状況（2026-01-20時点）

### Phase 1 MVP: 85%完成

| コンポーネント | 完成度 | 状態 |
|--------------|--------|------|
| バックエンドAPI | 95% | ✅ 主要機能実装完了 |
| フロントエンドUI | 65% | 🔶 基本UI完成、統合が必要 |
| テストカバレッジ | 58.92% | ✅ pytest 94ケース + E2E 60+ケース |
| 監査機能 | 85% | ✅ ログAPI、履歴API完成 |
| SLA管理 | 100% | ✅ 完全実装済み |
| M365連携 | 50% | 🔶 テンプレート実装、Graph API未統合 |
| 環境構築 | 80% | 🔶 基本完成、分離が必要 |

### 実装済みAPI（12新規エンドポイント）
- 監査ログAPI: 4エンドポイント
- チケット履歴API: 1エンドポイント + 自動記録
- SLAポリシーAPI: 7エンドポイント

### 技術スタック
- **Backend**: FastAPI + SQLAlchemy 2.0 + SQLite/PostgreSQL
- **Frontend**: Vanilla JavaScript SPA
- **Test**: pytest (94ケース) + Playwright (60+ケース)
- **Auth**: JWT + bcrypt

---

## 3. 全体開発フェーズ（改訂版）

### Phase 0: プロジェクト統合・環境再構築 ⭐ 現在フェーズ
**期間**: 1-2週間
**優先度**: 最高

#### 目標
- 2プロジェクトのベストプラクティス統合
- 開発/本番環境の完全分離
- Windows/Linux両対応
- ドキュメント体系の再編成

#### タスク

**A. 環境分離（3日）**
- ✅ 開発環境ポート確定: Backend 8000, Frontend 8080 (HTTP)
- ✅ 本番環境ポート確定: Backend 8443, Frontend 443 (HTTPS)
- ✅ SSL証明書生成済み
- 🔶 環境別設定ファイル整理
- 🔶 自動起動スクリプト（Windows/Linux）
- 🔶 Nodeモジュール分離（必要に応じて）

**B. M365統合基盤（5日）**
- 🔲 GraphClient実装（`backend/m365/graph_client.py`）
- 🔲 証明書ベース認証
- 🔲 トークンキャッシュ機構
- 🔲 M365操作サービス（ライセンス、パスワードリセット等）
- 🔲 承認フロー統合
- 🔲 実施ログ自動記録

**C. 監査・セキュリティ強化（3日）**
- 🔲 JSON Lines監査ログ追加（API操作、M365操作）
- 🔲 PIIマスキング機能実装
- 🔲 ログローテーション設定
- 🔲 セキュリティレビュー実施

**D. ドキュメント再編成（2日）**
- 🔲 6カテゴリ構造採用
- 🔲 マスターインデックス作成
- 🔲 クイックスタートガイド
- 🔲 M365認証設定ガイド
- 🔲 運用Runbook作成

#### 判定基準
- [x] 開発/本番環境が独立して起動する
- [ ] M365 Graph API経由でユーザー情報を取得できる
- [ ] 承認フロー経由でM365操作を実行できる
- [ ] 監査ログが追記専用で記録される
- [ ] ドキュメントが体系化されている

---

### Phase 1: MVP完成・本番準備
**期間**: 2-3週間
**目標**: 本番環境での最小限運用開始

#### タスク

**A. フロントエンドUI刷新（1週間）**
- 🔲 Fluent Design適用
- 🔲 ダッシュボード強化（統計カード、SLA状況）
- 🔲 チケット詳細画面（履歴、添付、コメント）
- 🔲 承認フローUI（モーダル、確認ダイアログ）
- 🔲 M365操作確認UI

**B. 残機能実装（1週間）**
- 🔲 チケット詳細画面の完全実装
- 🔲 ナレッジ編集UI
- 🔲 ユーザー管理UI（Manager用）
- 🔲 レポート画面（SLA達成率、チケット統計）

**C. テスト・品質強化（1週間）**
- 🔲 pytest カバレッジ 60% → 80%
- 🔲 E2Eテスト実行・検証
- 🔲 セキュリティスキャン
- 🔲 パフォーマンステスト

#### 判定基準
- [ ] 全UIページが実装完了
- [ ] pytestカバレッジ80%以上
- [ ] E2Eテスト全パス
- [ ] 本番環境で動作確認完了

---

### Phase 2: M365連携強化
**期間**: 2-3週間
**目標**: Microsoft Graph API完全統合

#### タスク

**A. Graph API統合（1週間）**
- ユーザー情報取得
- ライセンス管理
- メールボックス権限
- グループメンバーシップ
- Teams管理

**B. 自動化（1週間）**
- 承認済み標準作業の自動実行
- PowerShell連携（オプション）
- バッチ処理

**C. 監視・アラート（1週間）**
- SLA期限超過通知
- M365サービス稼働状況監視
- エラーアラート

#### 判定基準
- [ ] Graph API経由で10種類以上のM365操作が可能
- [ ] 承認済み操作が自動実行される
- [ ] SLA違反時に自動通知される

---

### Phase 3: エンタープライズ機能拡張
**期間**: 3-4週間
**目標**: エンタープライズ要件対応

#### タスク
- カスタムワークフロー
- 多言語対応（日本語・英語）
- 高度な分析・レポート
- インシデント管理（Problem Management）
- 変更管理（Change Management）

---

## 4. 環境構成

### 開発環境
```
URL: http://192.168.0.187:8080 [開発]
API: http://192.168.0.187:8000
ポート: 固定（変更禁止）
プロトコル: HTTP
データ: サンプルデータ豊富
用途: 開発・テスト
```

### 本番環境
```
URL: https://192.168.0.187 [本番]
API: https://192.168.0.187:8443
ポート: 固定（変更禁止）
プロトコル: HTTPS（自己署名証明書）
データ: サンプルデータなし
用途: 実運用
自動起動: systemd (Linux) / タスクスケジューラ (Windows)
```

### クロスプラットフォーム対応
- **Windows**: PowerShellスクリプト、`.venv-win`
- **Linux**: シェルスクリプト、`.venv-linux`, systemd
- **Nodeモジュール**: 環境別に分離（推奨）

---

## 5. 技術統合マップ

### 監査・セキュリティ（Enterprise-IT-Helpdesk-AI）

| 機能 | 統合先 | 優先度 |
|------|--------|--------|
| JSON Lines監査ログ | `logs/api_operations.jsonl`, `logs/m365_operations.jsonl` | 高 |
| PIIマスキング | `backend/utils/masking.py` | 高 |
| ログローテーション | `scripts/rotate-logs.ps1`, `logrotate.conf` | 中 |
| セキュリティレビュー | Phase 0実施 | 高 |
| 運用Runbook | `docs/02_管理者向け/運用マニュアル.md` | 中 |

### M365統合（MicrosoftProductManagementSystem）

| 機能 | 統合先 | 優先度 |
|------|--------|--------|
| GraphClient | `backend/m365/graph_client.py` | 高 |
| 証明書ベース認証 | `backend/m365/auth.py` | 高 |
| M365操作サービス | `backend/m365/operations.py` | 高 |
| Fluent Design UI | `frontend/css/fluent-design.css` | 中 |
| 包括的ドキュメント | `docs/` 全体再編成 | 高 |

---

## 6. リスクと対策

### リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|---------|------|
| M365 API認証エラー | 高 | 中 | 詳細な認証設定ガイド作成 |
| 環境分離の不完全 | 中 | 低 | 徹底的なテスト |
| ドキュメント複雑化 | 低 | 中 | マスターインデックス、検索機能 |
| パフォーマンス劣化 | 中 | 低 | キャッシュ機構、非同期処理 |

---

## 7. 成功指標

### Phase 0完了時
- ✅ 開発/本番環境が独立して起動
- ✅ M365 Graph API経由でユーザー情報取得
- ✅ 監査ログが追記専用で記録
- ✅ ドキュメントが体系化

### Phase 1完了時
- ✅ 全UIページ実装
- ✅ pytestカバレッジ80%
- ✅ E2Eテスト全パス
- ✅ 本番環境稼働

### Phase 2完了時
- ✅ 10種類以上のM365操作が可能
- ✅ 承認済み操作が自動実行
- ✅ SLA違反時に自動通知

---

## 8. 次のアクション（優先順位順）

### 即時（今日）
1. ✅ 環境設定ファイルの整理
2. ✅ 自動起動スクリプト作成（Windows/Linux）
3. 🔲 GraphClient基盤実装開始

### 今週
1. 🔲 M365認証設定ガイド作成
2. 🔲 JSON Lines監査ログ追加
3. 🔲 PIIマスキング実装
4. 🔲 ドキュメント構造化

### 来週
1. 🔲 Fluent Design UI適用
2. 🔲 フロントエンドUI統合
3. 🔲 E2Eテスト実行・検証

---

**更新履歴**
- 2026-01-20: 初版作成（2プロジェクト統合版）
- 2026-01-19: Phase 1 MVP 85%達成（SLA API、監査ログAPI、チケット履歴API実装完了）
