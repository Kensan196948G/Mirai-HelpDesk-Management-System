
---

# 1. 文書情報

* 文書名：ヘルプデスク運用システム 要件定義・詳細仕様書
* 対象：社内IT部門／全従業員（利用者）／一部総務・管理職（承認者）
* 適用範囲：インシデント／サービス要求／Microsoft 365（Exchange/Teams/OneDrive/Entra）関連の運用問い合わせ・作業・証跡

---

# 2. 背景と目的

## 2.1 背景

* 問い合わせが口頭・メール・チャットに分散 → **対応漏れ／属人化／証跡不足**
* Microsoft 365 の作業（アカウント、ライセンス、メール、共有、Teams等）が増え、**権限・監査・手順**が必要
* 少人数体制でも回る、**標準化された運用（SLA/優先度/エスカレーション/記録）**が求められる

## 2.2 目的（達成状態）

* 問い合わせを **チケットで一元管理**（受付→分類→対応→完了→評価）
* Microsoft 365 の対応を **定型化（申請/承認/実施/証跡）**
* **SLA・KPI・証跡（監査対応）**を標準で出せる
* ナレッジを蓄積し、**自己解決率を上げる（問い合わせ削減）**

---

# 3. スコープ

## 3.1 対象業務

* インシデント管理（障害・不具合）
* サービス要求管理（依頼：アカウント、権限、PC、ソフト、M365設定）
* 変更管理（軽微/標準変更の扱い：M365設定変更、ポリシー変更等）
* ナレッジ管理（FAQ、手順書、既知の問題、回避策）
* Microsoft 365 運用（Graph/Exchange/Teams/SharePoint/OneDrive/Entra ID）
* 資産・構成情報の参照（最低限でOK：ユーザー・端末・ライセンス・グループ）

## 3.2 対象外（例）

* 大規模ITILフル実装（Problem/Releaseを最初から完全運用）
  → ただし「将来拡張」は要件に含める

---

# 4. 利用者・役割（RBAC）

## 4.1 役割定義（最小構成）

* **Requester（一般社員）**：問い合わせ登録、状況確認、追加情報、完了確認
* **Agent（一次対応）**：受付、分類、回答、作業、エスカレーション
* **M365 Operator（特権作業者）**：M365系の実作業（実施ログ必須）
* **Approver（承認者）**：権限付与・ライセンス変更等の承認
* **Manager（運用管理者）**：SLA/KPI、テンプレ、カテゴリ、権限、監査閲覧
* **Auditor（監査閲覧）**：閲覧専用（操作不可）

## 4.2 SOD（同一案件の兼務禁止）

* 同一チケットにおいて

  * **承認者 ≠ 実施者（M365 Operator）**
  * **実施者 ≠ 監査承認（完了承認）**
    を原則とする（少人数でも“案件単位”で分離）

---

# 5. 業務フロー（状態遷移）

## 5.1 チケット共通ステータス

* New（新規）
* Triage（受付・分類中）
* Assigned（担当割当済）
* In Progress（対応中）
* Pending Customer（利用者回答待ち）
* Pending Approval（承認待ち）
* Pending Change Window（実施待ち：時間帯指定）
* Resolved（解決：クローズ待ち）
* Closed（完了）
* Canceled（取消）
* Reopened（再開）

### 必須ルール

* **解決（Resolved）→ 完了（Closed）**の間に、利用者確認（もしくはタイムアウト自動完了）を挟む
* M365作業を伴う場合、**「承認→実施→実施ログ→完了」**が必須

## 5.2 優先度・緊急度（Impact × Urgency）

* Impact（影響度）：個人 / 部署 / 全社 / 対外影響
* Urgency（緊急度）：低 / 中 / 高 / 即時
* これを元に Priority（P1〜P4）を自動計算

### SLA例（初期案）

* P1（全社停止）: 初動 15分 / 暫定復旧 2h / 恒久 24h
* P2（部門影響）: 初動 1h / 復旧 8h
* P3（個人）: 初動 4h / 解決 3営業日
* P4（問い合わせ）: 初動 1営業日 / 解決 5営業日

---

# 6. 機能要件（Must / Should / Future）

## 6.1 チケット管理（Must）

* チケット起票（Webフォーム/メール取込/Teamsボット取込は段階導入可）
* カテゴリ分類（M365/PC/ネット/アプリ/権限/アカウント…）
* 担当割当（手動＋ルール割当）
* コメント（公開：利用者向け／非公開：内部メモ）
* 添付（ログ、スクショ、CSV、エビデンス）
* 関連付け（重複、親子、同一原因候補）
* テンプレ返信（定型文）
* クローズ処理（解決分類、原因、再発防止メモ、満足度）

## 6.2 Microsoft 365 ヘルプデスク（Must）

* **作業種別テンプレ**（申請→承認→実施→証跡）
  例）

  * ライセンス付与/剥奪
  * パスワードリセット（オンプレAD連携がある場合含む）
  * MFA/認証方法リセット
  * メールボックス権限（フルアクセス/送信代理）
  * メーリングリスト/グループ追加
  * Teams チーム作成/所有者変更
  * OneDrive リストア/共有解除（禁止運用の徹底）
  * 退職者処理（アカウント無効化、メール転送、保持、データ扱い）
* **Graph/管理センター操作の証跡記録**

  * だれが、いつ、何を、なぜ（チケット紐付け）実施したか
* “実施チェックリスト”機能（抜け防止）

## 6.3 ナレッジ管理（Must）

* FAQ／手順書／既知の問題（Known Error）／回避策（Workaround）
* チケットからナレッジ化（ワンクリック雛形生成）
* 検索（タグ、カテゴリ、全文、M365サービス別）
* 公開範囲（全社/部署/ITのみ）

## 6.4 通知・連携（Must）

* 通知：メール（必須）、Teams（可能なら）
* 通知条件：新規、担当割当、承認依頼、期限超過、完了、差戻し
* 監査ログ出力（CSV/JSON/PDF）

## 6.5 レポート・KPI（Must）

* SLA達成率（P別、カテゴリ別）
* 平均初動/平均解決時間
* バックログ（未処理/期限超過）
* 再オープン率
* ナレッジ参照数・自己解決率（将来）

## 6.6 変更管理（Should）

* 標準変更テンプレ（例：M365設定変更・例外付与）
* 変更リスク評価（低/中/高）・実施ウィンドウ・ロールバック手順
* CAB（会議）までは最初は不要。承認フローで代替

## 6.7 自動化（Future）

* Graph APIで“作業自動実施”（ただし**SOD/承認**が前提）
* 例：ライセンス付与の自動化、グループ追加、退職者処理Runbook化

---

# 7. 画面仕様（主要UI）

## 7.1 利用者ポータル

* ダッシュボード：自分のチケット一覧、対応状況、期限、ITからの依頼
* 新規作成フォーム：

  * 件名（必須）
  * 問い合わせ種別（必須：インシデント/依頼/M365）
  * カテゴリ（必須）
  * 影響範囲（必須）
  * 緊急度（必須）
  * 本文（必須）
  * 添付（任意）
  * 希望対応時間帯（任意）
* チケット詳細：

  * ステータス、担当者、履歴、コメント（公開）、追加情報送信、完了確認
* ナレッジ検索（FAQ）

## 7.2 エージェントコンソール

* キュー（未割当、P1/P2、期限超過、承認待ち）
* 一覧フィルタ（カテゴリ/担当/ステータス/優先度/拠点）
* チケット詳細（内部メモ、作業チェックリスト、関連付け）
* 返信テンプレ
* エスカレーション（M365 Operatorへ、管理者へ）

## 7.3 M365作業画面（特権作業者）

* 作業依頼内容（承認状態、対象ユーザー、対象グループ等）
* 実施チェックリスト（必須項目を埋めないと完了不可）
* 実施ログ入力：

  * 実施内容（必須）
  * 実施方法（管理センター/PowerShell/Graph）
  * 変更対象（UPN/GroupID等）
  * 実施結果（成功/失敗）
  * エビデンス添付（スクショ/出力ログ）
* ロールバック手順（変更系は必須）

## 7.4 管理者画面

* マスタ管理（カテゴリ、優先度ルール、SLA、テンプレ、フォーム）
* RBAC管理（役割、権限、操作範囲）
* 監査ログ検索（ユーザー・期間・チケット・操作種別）
* KPIレポート

---

# 8. データ設計（論理モデル）

## 8.1 主要テーブル（例）

* `tickets`

  * `ticket_id`(PK), `type`, `subject`, `description`, `status`, `priority`, `impact`, `urgency`
  * `requester_id`, `assignee_id`, `created_at`, `updated_at`, `resolved_at`, `closed_at`
  * `category_id`, `sla_policy_id`, `due_at`
* `ticket_comments`

  * `comment_id`(PK), `ticket_id`(FK), `author_id`, `visibility`(public/internal), `body`, `created_at`
* `ticket_attachments`

  * `attachment_id`, `ticket_id`, `uploader_id`, `filename`, `hash`, `storage_path`, `created_at`
* `ticket_history`

  * `history_id`, `ticket_id`, `actor_id`, `action`, `before`, `after`, `created_at`
* `approvals`

  * `approval_id`, `ticket_id`, `approver_id`, `state`(requested/approved/rejected), `comment`, `created_at`
* `m365_tasks`

  * `task_id`, `ticket_id`, `task_type`, `target_upn`, `target_resource_id`, `state`
* `m365_execution_logs`

  * `exec_id`, `task_id`, `operator_id`, `method`, `command_or_screen`, `result`, `evidence_attachment_id`, `created_at`
* `knowledge_articles`

  * `article_id`, `title`, `body`, `tags`, `visibility`, `owner_id`, `created_at`, `updated_at`
* `users`（連携元があるなら参照キャッシュ）

  * `user_id`, `display_name`, `email`, `dept`, `role`, `status`

## 8.2 監査観点の必須カラム

* “誰が/いつ/何を/なぜ”

  * `actor_id`, `created_at`, `action`, `reason`（またはコメント紐付け）

---

# 9. API仕様（例：REST）

## 9.1 チケット

* `POST /api/tickets`：作成
* `GET /api/tickets?status=&assignee=&priority=`：一覧
* `GET /api/tickets/{id}`：詳細
* `PATCH /api/tickets/{id}`：更新（ステータス、担当、カテゴリ等）
* `POST /api/tickets/{id}/comments`：コメント
* `POST /api/tickets/{id}/attachments`：添付

## 9.2 承認

* `POST /api/tickets/{id}/approvals/request`
* `POST /api/approvals/{approval_id}/approve`
* `POST /api/approvals/{approval_id}/reject`

## 9.3 M365作業

* `POST /api/tickets/{id}/m365_tasks`：作業タスク生成
* `POST /api/m365_tasks/{id}/execute_log`：実施ログ登録

---

# 10. Microsoft 365 連携仕様（実装方針）

## 10.1 連携方式（推奨）

* **Microsoft Graph API**（基本）
* Exchange Online 操作が必要なら

  * Graph で可能な範囲を優先
  * 必要に応じて PowerShell 実行ログを証跡として添付（コマンド出力など）

## 10.2 連携対象（最低限）

* ユーザー情報（UPN、表示名、部署、状態）
* ライセンス（割当状況）
* グループ/Teams（所有者、メンバー）
* OneDrive（対象特定、復元操作がある場合は記録必須）

## 10.3 重要ルール（監査・安全）

* “自動実行”は **承認済みチケットに紐付く場合のみ**
* 実行結果（成功/失敗）を `m365_execution_logs` に必ず残す
* 失敗時はロールバック・代替手順を記録

---

# 11. 非機能要件

## 11.1 セキュリティ

* 認証：SSO（Entra ID）または社内認証基盤（優先はSSO）
* 認可：RBAC（役割×機能×データ範囲）
* 重要操作（権限付与、ライセンス変更等）：

  * 承認必須
  * 実施ログ必須
* 添付ファイル：マルウェア対策（最低限：拡張子制限＋ハッシュ）
* データ暗号化：保存時暗号化（可能なら）／通信TLS

## 11.2 可用性・性能

* 目標稼働率：社内業務時間で 99.5%（目安）
* RPO/RTO（例）：RPO 24h / RTO 4h（後に引き上げ可能）
* 同時アクセス：全社員を想定しつつ、実際はピーク数十〜数百

## 11.3 監査・ログ

* 操作ログ：改ざん検知（少なくとも追記型、削除禁止、管理者でも履歴残す）
* エクスポート：月次でCSV/PDF出力
* ログ保持：最低 2年（社内規程に合わせる）

## 11.4 運用性

* テンプレ・カテゴリ・SLAを管理画面から変更可能
* “新人でも迷子にならない”導線（ボタンは少なく、選択肢は絞る）

---

# 12. 運用設計（実際に回すための標準）

## 12.1 受付チャネル

* フロント：ポータル（最優先）
* 次点：メール受付（取り込み）
* 可能なら：Teams（フォーム/ボット）

## 12.2 当番（一次対応）と特権（M365）

* Agent（一次）が切り分け
* M365 Operator（特権）が作業
* Manager がKPI・品質・監査

## 12.3 定例

* 週次：バックログ棚卸し（期限超過ゼロ化）
* 月次：KPIレビュー、テンプレ改善、ナレッジ棚卸し

---

# 13. 受入基準（UAT観点）

* チケットが必須項目なしで作成できない
* 優先度がルール通りに算出される
* 承認なしでM365作業が完了できない
* 実施ログ（誰が/いつ/何を/結果）が必ず残る
* 履歴（ステータス変更等）が消せない／追える
* SLAの期限超過が検知でき、通知が飛ぶ
* KPIレポートが月次で出力できる

---

# 14. 実装の最小リリース（MVP）提案

**最初から全部は“腹筋崩壊レベルに大変”**なので、段階を切ります（でも監査は最初から効くように）。

## Phase 1（最短で運用開始）

* チケット（起票/分類/担当/コメント/添付/履歴）
* SLA（簡易）＋期限通知
* ナレッジ（FAQ）
* M365は「作業テンプレ＋承認＋実施ログ（手入力）」まで

## Phase 2（M365連携強化）

* Graphでユーザー/ライセンス参照
* 作業ログの自動取り込み（PowerShell出力の添付テンプレ）

## Phase 3（自動化）

* 承認済みの定型作業のみ自動実行（例：グループ追加）

---
