# ナレッジ編集UI クイックスタートガイド

## セットアップ

### 1. 依存パッケージのインストール

```bash
cd frontend
npm install
```

必要なパッケージ（marked, dompurify）は既にインストール済みです。

### 2. 開発サーバーの起動

```bash
npm run dev
```

ブラウザで `http://localhost:5173` にアクセス

## 使い方

### ナレッジ一覧ページ

1. ログイン後、サイドメニューから「ナレッジベース」を選択
2. **Agent以上の権限**の場合、「新規作成」ボタンが表示される

### ナレッジ記事の作成

1. 「新規作成」ボタンをクリック
2. 以下を入力：
   - **タイトル**: 記事のタイトル（必須、200文字以内）
   - **サマリー**: 概要（任意、500文字以内）
   - **本文**: Markdown形式で記述（必須）
   - **記事種別**: FAQ、手順書、既知の問題、回避策、ポリシー、お知らせ（必須）
   - **カテゴリ**: 選択（任意）
   - **タグ**: Enterキーまたはカンマ区切りで追加（任意）
   - **公開範囲**: 公開、スタッフのみ、非公開（必須）
3. 公開設定：
   - **公開ステータス**: 公開/下書き切り替え
   - **おすすめ記事**: おすすめとして表示するか
4. 「プレビュー」で確認
5. 「作成」または「下書き保存」をクリック

### Markdownエディタの使い方

#### ツールバー
- **B**: 太字（`**テキスト**`）
- **I**: 斜体（`*テキスト*`）
- **H**: 見出し（`## 見出し`）
- **•**: 箇条書きリスト（`- 項目`）
- **1.**: 番号付きリスト（`1. 項目`）
- **🔗**: リンク（`[テキスト](URL)`）
- **</>**: コードブロック（` ```コード``` `）
- **📷**: 画像（`![説明](URL)`）

#### Markdown記法の例

```markdown
# 大見出し

## 中見出し

### 小見出し

**太字テキスト**

*斜体テキスト*

[リンクテキスト](https://example.com)

- 箇条書き1
- 箇条書き2

1. 番号付きリスト1
2. 番号付きリスト2

`インラインコード`

\`\`\`
コードブロック
\`\`\`

![画像の説明](https://example.com/image.png)

> 引用文

---

水平線
```

#### タブの切り替え
- **編集タブ**: Markdown記法で編集
- **プレビュータブ**: 実際の表示を確認

### タグの追加

1. タグ入力欄にタグ名を入力
2. **Enter**キーまたは**カンマ**で追加
3. 追加されたタグの「×」をクリックで削除

### プレビュー機能

1. 「プレビュー」ボタンをクリック
2. モーダルで実際の表示を確認
3. 「閉じる」で編集に戻る

### ナレッジ記事の編集

#### 権限
- **著者**: 自分が作成した記事を編集可能
- **Manager**: すべての記事を編集可能

#### 手順
1. ナレッジ一覧またはナレッジ詳細で「編集」ボタンをクリック
2. 内容を編集
3. 「更新」をクリック

### ナレッジ記事の削除

#### 権限
- **Manager**のみ削除可能

#### 手順
1. ナレッジ一覧で「削除」ボタンをクリック
2. 確認ダイアログで「削除」をクリック

## 開発時のヒント

### デバッグ

#### React DevTools
```bash
# Chrome拡張機能をインストール
```

#### コンソールログ
```typescript
// knowledgeService.tsでAPIレスポンスを確認
console.log('API Response:', response);
```

### コンポーネント構造

```
KnowledgeEditor
├── Form (Ant Design)
│   ├── 基本情報
│   │   ├── Input (タイトル)
│   │   └── TextArea (サマリー)
│   ├── 本文
│   │   └── MarkdownEditor
│   │       ├── Tabs (編集/プレビュー)
│   │       ├── Toolbar
│   │       └── TextArea / Preview
│   ├── メタデータ
│   │   ├── Select (記事種別)
│   │   ├── Select (カテゴリ)
│   │   ├── Input + Tags (タグ)
│   │   └── Select (公開範囲)
│   └── 公開設定
│       ├── Switch (公開/下書き)
│       └── Switch (おすすめ)
├── Buttons (キャンセル、プレビュー、保存)
└── Modal (プレビュー)
```

### スタイルのカスタマイズ

Fluent Designテーマは `frontend/src/main.tsx` で定義されています。

```typescript
const fluentTheme = {
  token: {
    colorPrimary: '#0078d4', // プライマリカラー
    // ...
  },
};
```

### API統合

`frontend/src/services/knowledgeService.ts` でAPI呼び出しを定義しています。

バックエンドのエンドポイントは環境変数で設定：
```env
VITE_API_BASE_URL=http://localhost:3000/api
```

## トラブルシューティング

### 問題: ページが表示されない

**確認事項**:
1. 開発サーバーが起動しているか
2. ログインしているか
3. ブラウザのコンソールでエラーを確認

### 問題: Markdownが正しく表示されない

**確認事項**:
1. Markdown構文が正しいか
2. プレビュータブで確認
3. ブラウザのコンソールでエラーを確認

### 問題: 保存できない

**確認事項**:
1. 必須項目が入力されているか
2. ネットワークタブでAPIエラーを確認
3. 権限があるか確認

### 問題: 編集ボタンが表示されない

**確認事項**:
1. Agent以上の権限があるか
2. 自分が作成した記事か（またはManager権限か）
3. ログイン状態を確認

## テストデータの作成

開発時に以下のようなテストデータを作成すると便利です：

### FAQ記事の例

**タイトル**: パスワードをリセットする方法

**本文**:
```markdown
# パスワードをリセットする方法

パスワードを忘れた場合、以下の手順でリセットできます。

## 手順

1. ログイン画面の「パスワードをお忘れですか？」をクリック
2. メールアドレスを入力
3. 受信したメールのリンクをクリック
4. 新しいパスワードを設定

## 注意事項

- パスワードは8文字以上
- 英数字と記号を含める
- 過去のパスワードは使用不可

## 問題が解決しない場合

IT部門にお問い合わせください。
```

**タグ**: パスワード, リセット, アカウント

### 手順書の例

**タイトル**: Microsoft Teams で会議を作成する方法

**本文**:
```markdown
# Microsoft Teams で会議を作成する方法

## 前提条件

- Microsoft 365アカウント
- Teamsアプリがインストール済み

## 手順

### 1. 新しい会議を作成

1. Teamsを開く
2. 左側のメニューから「カレンダー」を選択
3. 右上の「新しい会議」をクリック

### 2. 会議の詳細を入力

- **タイトル**: 会議名を入力
- **日時**: 開始と終了時刻を設定
- **参加者**: メールアドレスを入力

### 3. オプション設定

- ロビーを有効にする
- レコーディングを許可する
- チャットを有効にする

### 4. 会議を保存

「送信」ボタンをクリックして会議を作成します。

## 参考リンク

[Microsoft公式ドキュメント](https://docs.microsoft.com/teams)
```

**タグ**: Teams, 会議, Microsoft 365

## ベストプラクティス

### Markdown記法
1. 見出しは階層的に使う（H1 → H2 → H3）
2. コードブロックには言語を指定する
3. 画像には適切な代替テキストを付ける
4. リンクはわかりやすいテキストにする

### 記事の構成
1. **導入**: 記事の目的を明確に
2. **本文**: 手順は番号付きリストで
3. **まとめ**: 重要なポイントを再確認
4. **参考リンク**: 関連情報へのリンク

### タグ付け
1. 具体的なキーワードを使う
2. 3〜5個程度が適切
3. 既存のタグを活用する

### カテゴリ選択
1. 最も関連性の高いカテゴリを選ぶ
2. カテゴリは一つのみ
3. 該当するカテゴリがない場合は「その他」

## 参考資料

- [Markdown記法チートシート](https://www.markdownguide.org/cheat-sheet/)
- [Microsoft Fluent Design](https://www.microsoft.com/design/fluent/)
- [Ant Design Documentation](https://ant.design/)
- [React Documentation](https://react.dev/)

## サポート

問題が解決しない場合は、以下を確認してください：
- `frontend/src/pages/knowledge/README.md`: 詳細な実装ガイド
- `KNOWLEDGE_EDITOR_IMPLEMENTATION.md`: 実装完了報告
- GitHub Issues: バグ報告や機能要望
